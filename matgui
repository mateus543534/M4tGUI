local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "M4TGUI"
gui.ResetOnSpawn = false

local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- vars pra resize
local resizing = false
local resizeStartMousePos
local resizeStartSize
local minSize = Vector2.new(300, 200)

-- frame principal
local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0, 500, 0, 350)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Name = "MainFrame"
mainFrame.ClipsDescendants = true
mainFrame.BorderSizePixel = 0

-- bordas arredondadas
local corner = Instance.new("UICorner", mainFrame)
corner.CornerRadius = UDim.new(0, 10)

-- barra superior
local topBar = Instance.new("Frame", mainFrame)
topBar.Size = UDim2.new(1, 0, 0, 30)
topBar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)

local topCorner = Instance.new("UICorner", topBar)
topCorner.CornerRadius = UDim.new(0, 10)

-- botões de abas
local menuBtn = Instance.new("TextButton", topBar)
menuBtn.Size = UDim2.new(0, 100, 1, 0)
menuBtn.Text = "Menu"
menuBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
menuBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
menuBtn.TextScaled = true

local playerBtn = Instance.new("TextButton", topBar)
playerBtn.Size = UDim2.new(0, 100, 1, 0)
playerBtn.Position = UDim2.new(0, 100, 0, 0)
playerBtn.Text = "Player"
playerBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
playerBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
playerBtn.TextScaled = true

-- minimizar e fechar
local minimizeBtn = Instance.new("TextButton", topBar)
minimizeBtn.Size = UDim2.new(0, 25, 0, 25)
minimizeBtn.Position = UDim2.new(1, -50, 0, 2)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeBtn.TextScaled = true

local closeBtn = Instance.new("TextButton", topBar)
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(1, -25, 0, 2)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextScaled = true

-- frame minimizado
local miniFrame = Instance.new("Frame", gui)
miniFrame.Size = UDim2.new(0, 150, 0, 30)
miniFrame.Position = mainFrame.Position
miniFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
miniFrame.Visible = false
miniFrame.Active = true
miniFrame.Draggable = true

local miniLabel = Instance.new("TextLabel", miniFrame)
miniLabel.Size = UDim2.new(1, -30, 1, 0)
miniLabel.Position = UDim2.new(0, 0, 0, 0)
miniLabel.BackgroundTransparency = 1
miniLabel.Text = "M4TGUI"
miniLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
miniLabel.TextScaled = true

local miniBtn = Instance.new("TextButton", miniFrame)
miniBtn.Size = UDim2.new(0, 30, 0, 30)
miniBtn.Position = UDim2.new(1, -30, 0, 0)
miniBtn.Text = "-"
miniBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
miniBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
miniBtn.TextScaled = true

-- botão de redimensionar no canto baixo direito
local resizeBtn = Instance.new("Frame", mainFrame)
resizeBtn.Size = UDim2.new(0, 20, 0, 20)
resizeBtn.Position = UDim2.new(1, -20, 1, -20)
resizeBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
resizeBtn.AnchorPoint = Vector2.new(1, 1)
resizeBtn.Active = true
resizeBtn.ZIndex = 10

local resizeCorner = Instance.new("UICorner", resizeBtn)
resizeCorner.CornerRadius = UDim.new(0, 6)

-- muda o cursor pra indicar resize (só se o executor suportar)
resizeBtn.MouseEnter:Connect(function()
	if UserInputService.MouseIconEnabled ~= nil then
		UserInputService.MouseIconEnabled = true
		UserInputService.MouseIcon = "rbxasset://SystemCursors/SizeNWSE"
	end
end)

resizeBtn.MouseLeave:Connect(function()
	if UserInputService.MouseIconEnabled ~= nil then
		UserInputService.MouseIconEnabled = true
		UserInputService.MouseIcon = ""
	end
end)

resizeBtn.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		resizing = true
		resizeStartMousePos = UserInputService:GetMouseLocation()
		resizeStartSize = Vector2.new(mainFrame.AbsoluteSize.X, mainFrame.AbsoluteSize.Y)
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				resizing = false
			end
		end)
	end
end)

resizeBtn.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement and resizing then
		local mousePos = UserInputService:GetMouseLocation()
		local delta = mousePos - resizeStartMousePos
		local newSize = resizeStartSize + Vector2.new(delta.X, delta.Y)
		if newSize.X < minSize.X then newSize = Vector2.new(minSize.X, newSize.Y) end
		if newSize.Y < minSize.Y then newSize = Vector2.new(newSize.X, minSize.Y) end
		mainFrame.Size = UDim2.new(0, newSize.X, 0, newSize.Y)
	end
end)

-- abas
local menuTab = Instance.new("Frame", mainFrame)
menuTab.Size = UDim2.new(1, 0, 1, -30)
menuTab.Position = UDim2.new(0, 0, 0, 30)
menuTab.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
menuTab.Visible = true

local playerTab = Instance.new("Frame", mainFrame)
playerTab.Size = UDim2.new(1, 0, 1, -30)
playerTab.Position = UDim2.new(0, 0, 0, 30)
playerTab.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
playerTab.Visible = false

-- trocar abas
local function openTab(tabName)
	menuTab.Visible = (tabName == "menu")
	playerTab.Visible = (tabName == "player")
	menuBtn.BackgroundColor3 = tabName == "menu" and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
	playerBtn.BackgroundColor3 = tabName == "player" and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
end

menuBtn.MouseButton1Click:Connect(function() openTab("menu") end)
playerBtn.MouseButton1Click:Connect(function() openTab("player") end)
openTab("menu")

-- minimizar/maximizar
minimizeBtn.MouseButton1Click:Connect(function()
	mainFrame.Visible = false
	miniFrame.Position = mainFrame.Position
	miniFrame.Visible = true
end)

miniBtn.MouseButton1Click:Connect(function()
	mainFrame.Visible = true
	mainFrame.Position = miniFrame.Position
	miniFrame.Visible = false
end)

closeBtn.MouseButton1Click:Connect(function()
	gui:Destroy()
end)

-- creditos menu
local creditsText = Instance.new("TextLabel", menuTab)
creditsText.Size = UDim2.new(1, -20, 0, 60)
creditsText.Position = UDim2.new(0, 10, 0, 10)
creditsText.BackgroundTransparency = 1
creditsText.TextColor3 = Color3.fromRGB(255,255,255)
creditsText.TextScaled = true
creditsText.TextWrapped = true
creditsText.Text = "LUIZ = primo, valeu pelas ideias\nmateus = DONO, ENTRE DISCORD ="

local discordBtn = Instance.new("TextButton", menuTab)
discordBtn.Size = UDim2.new(0, 400, 0, 40)
discordBtn.Position = UDim2.new(0, 50, 0, 80)
discordBtn.Text = "https://discord.gg/QGw7Tftq (CLICA PRA COPIAR)"
discordBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
discordBtn.TextScaled = true
discordBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 120)

if setclipboard then
	discordBtn.MouseButton1Click:Connect(function()
		setclipboard("https://discord.gg/QGw7Tftq")
		discordBtn.Text = "COPIADO!"
		wait(1.5)
		discordBtn.Text = "https://discord.gg/QGw7Tftq (CLICA PRA COPIAR)"
	end)
end

-- player tab: noclip
local noclipLabel = Instance.new("TextLabel", playerTab)
noclipLabel.Size = UDim2.new(0, 100, 0, 30)
noclipLabel.Position = UDim2.new(0, 10, 0, 10)
noclipLabel.BackgroundTransparency = 1
noclipLabel.Text = "noclip"
noclipLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
noclipLabel.TextScaled = true

local noclipSwitch = Instance.new("TextButton", playerTab)
noclipSwitch.Size = UDim2.new(0, 60, 0, 30)
noclipSwitch.Position = UDim2.new(0, 120, 0, 10)
noclipSwitch.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
noclipSwitch.Text = "OFF"
noclipSwitch.TextColor3 = Color3.fromRGB(255, 255, 255)
noclipSwitch.TextScaled = true

local isNoclip = false
noclipSwitch.MouseButton1Click:Connect(function()
	isNoclip = not isNoclip
	noclipSwitch.Text = isNoclip and "ON" or "OFF"
	noclipSwitch.BackgroundColor3 = isNoclip and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
end)

RunService.Stepped:Connect(function()
	if player.Character then
		for _, part in pairs(player.Character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = not isNoclip and true or false
			end
		end
	end
end)

-- player tab: fly
local flyLabel = Instance.new("TextLabel", playerTab)
flyLabel.Size = UDim2.new(0, 100, 0, 30)
flyLabel.Position = UDim2.new(0, 10, 0, 50)
flyLabel.BackgroundTransparency = 1
flyLabel.Text = "fly"
flyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
flyLabel.TextScaled = true

local flySwitch = Instance.new("TextButton", playerTab)
flySwitch.Size = UDim2.new(0, 60, 0, 30)
flySwitch.Position = UDim2.new(0, 120, 0, 50)
flySwitch.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
flySwitch.Text = "OFF"
flySwitch.TextColor3 = Color3.fromRGB(255, 255, 255)
flySwitch.TextScaled = true

local flying = false
local flyKeys = {W = false, A = false, S = false, D = false, Space = false, Shift = false}
local humanoid = nil
local rootPart = nil
local speed = 50

local function startFly()
	if flying then return end
	flying = true
	humanoid = character:FindFirstChildOfClass("Humanoid")
	rootPart = character:FindFirstChild("HumanoidRootPart")
	if humanoid then
		humanoid:ChangeState(Enum.HumanoidStateType.Physics)
	end
end

local function stopFly()
	if not flying then return end
	flying = false
	if humanoid then
		humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
	end
end

flySwitch.MouseButton1Click:Connect(function()
	if flying then
		stopFly()
		flySwitch.Text = "OFF"
		flySwitch.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
	else
		startFly()
		flySwitch.Text = "ON"
		flySwitch.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
	end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	local code = input.KeyCode
	if code == Enum.KeyCode.W then flyKeys.W = true end
	if code == Enum.KeyCode.A then flyKeys.A = true end
	if code == Enum.KeyCode.S then flyKeys.S = true end
	if code == Enum.KeyCode.D then flyKeys.D = true end
	if code == Enum.KeyCode.Space then flyKeys.Space = true end
	if code == Enum.KeyCode.LeftShift then flyKeys.Shift = true end
	if code == Enum.KeyCode.E then
		if flying then
			stopFly()
			flySwitch.Text = "OFF"
			flySwitch.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
		else
			startFly()
			flySwitch.Text = "ON"
			flySwitch.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
		end
	end
	if code == Enum.KeyCode.Q then
		isNoclip = not isNoclip
		noclipSwitch.Text = isNoclip and "ON" or "OFF"
		noclipSwitch.BackgroundColor3 = isNoclip and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
	end
end)

UserInputService.InputEnded:Connect(function(input)
	local code = input.KeyCode
	if code == Enum.KeyCode.W then flyKeys.W = false end
	if code == Enum.KeyCode.A then flyKeys.A = false end
	if code == Enum.KeyCode.S then flyKeys.S = false end
	if code == Enum.KeyCode.D then flyKeys.D = false end
	if code == Enum.KeyCode.Space then flyKeys.Space = false end
	if code == Enum.KeyCode.LeftShift then flyKeys.Shift = false end
end)

RunService.RenderStepped:Connect(function(delta)
	if flying and rootPart then
		local cam = workspace.CurrentCamera
		local dir = Vector3.new()
		if flyKeys.W then dir = dir + cam.CFrame.LookVector end
		if flyKeys.S then dir = dir - cam.CFrame.LookVector end
		if flyKeys.A then dir = dir - cam.CFrame.RightVector end
		if flyKeys.D then dir = dir + cam.CFrame.RightVector end
		if flyKeys.Space then dir = dir + Vector3.new(0, 1, 0) end
		if flyKeys.Shift then dir = dir - Vector3.new(0, 1, 0) end

		if dir.Magnitude > 0 then
			dir = dir.Unit * speed * delta
			rootPart.CFrame = rootPart.CFrame + dir
		end
	end
end)
